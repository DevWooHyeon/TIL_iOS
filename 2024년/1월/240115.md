# TIL

### ğŸ”¥ Core Data ë€?

**Core Data ëŠ” ì• í”Œì—ì„œ ì œê³µí•˜ëŠ” Framework ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.**

Core Data ë¥¼ ì‚¬ìš©í•˜ë©´ ì•±ì˜ ì˜êµ¬ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

UserDefaults ì™€ ë¹„ìŠ·í•˜ë‹¤ê³  ìƒê°í•  ìˆ˜ ìˆì§€ë§Œ ì¢€ ë” ë³µì¡í•˜ê³  í° ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ì„œ Core Data ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì í•©í•©ë‹ˆë‹¤.

~~~
Core Data ëŠ” Database ê°€ ì•„ë‹™ë‹ˆë‹¤!!
~~~

***

### ğŸ”¥ Core Data ì˜ ì£¼ìš”ê¸°ëŠ¥

#### âœ… Persistence(ì˜ì†ì„±)

Core Data ëŠ” ê°ì²´ë¥¼ ì €ì¥ì†Œì— ë§¤í•‘í•˜ëŠ” ì„¸ë¶€ ì •ë³´ë¥¼ ì¶”ìƒí™”í•˜ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•Šê³ ë„ ë°ì´í„°ë¥¼ ì‰½ê²Œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì´ë¯¸ì§€ëŠ” ì•±ì´ ì˜êµ¬ ì €ì¥ì†Œì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ê³¼ì •ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.

<img width="300" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/7ea5abd4-5a64-4b57-b3f3-da1b7912dfe1">

***

#### âœ… Undo and redo of individual and batched changes(ê°œë³„, ì¼ê´„ ë³€ê²½ì‚¬í•­ì˜ ì‹¤í–‰ì·¨ì†Œ ë° ë‹¤ì‹œì‹¤í–‰)

Core Data ì˜ ì‹¤í–‰ ì·¨ì†Œ ê´€ë¦¬ìëŠ” ë³€ê²½ ì‚¬í•­ì„ ì¶”ì í•˜ê³  ê°œë³„ì ìœ¼ë¡œë‚˜ ê·¸ë£¹ìœ¼ë¡œ ë˜ëŠ” í•œêº¼ë²ˆì— ë¡¤ë°±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ

ì•±ì— ì‹¤í–‰ ì·¨ì†Œ ë° ë‹¤ì‹œ ì‹¤í–‰ ì§€ì›ì„ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ì´í°ì—ì„œ ë©”ëª¨ë‚˜ ë©”ì‹œì§€ë¥¼ ì“°ë‹¤ê°€ í”ë“¤ë©´ ê¸€ìê°€ ì‚¬ë¼ì§€ëŠ” ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì´ë¯¸ì§€ëŠ” ê·¸ëŸ¬í•œ ì œìŠ¤ì²˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ ì·¨ì†Œë¥¼ í•˜ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.

<img width="550" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/2773c8c1-372f-4aca-81bd-bff1b6e14b95">

***

#### âœ… Background data tasks(ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ì‘ì—…)

ë°±ê·¸ë¼ìš´ë“œì—ì„œ JSONì„ ê°œì²´ë¡œ êµ¬ë¬¸ì„ ë¶„ì„í•˜ëŠ” ë“± UIë¥¼ ì°¨ë‹¨í•  ìˆ˜ ìˆëŠ” ë°ì´í„° ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. 

ê·¸ëŸ° ë‹¤ìŒ ê²°ê³¼ë¥¼ ìºì‹œí•˜ê±°ë‚˜ ì €ì¥í•˜ì—¬ ì„œë²„ ì™•ë³µì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì´ë¯¸ì§€ëŠ” UIë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ì „ì— ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê°œì²´ì— ë°ì´í„°ë¥¼ ì±„ìš°ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ëŠ” ì´ë¯¸ì§€ì…ë‹ˆë‹¤.

<img width="300" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/454c9c95-0016-459c-bf88-1997b9687279">

***

#### âœ… View synchronization(ë™ê¸°í™”)

Core Data ëŠ” í…Œì´ë¸” ë° ì»¬ë ‰ì…˜ ë·°ì— ëŒ€í•œ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì œê³µí•˜ì—¬ ë·°ì™€ ë°ì´í„°ì˜ ë™ê¸°í™”ë¥¼ ìœ ì§€í•˜ëŠ”ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

***

#### âœ… Versioning and migration(ë²„ì „ ê´€ë¦¬ ë° Migration)

Core Data ì—ëŠ” ì•±ì´ ë°œì „í•¨ì— ë”°ë¼ ë°ì´í„° ëª¨ë¸ ë²„ì „ì„ ê´€ë¦¬í•˜ê³  ì‚¬ìš©ì ë°ì´í„°ë¥¼ Migration í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

***

### ğŸ”¥ Generating Code(ì½”ë“œ ìƒì„±)

Entity ì™€ Attributes ë¥¼ ì„¤ì •í•œ í›„ì— inspector ë¥¼ í™•ì¸í•´ë³´ë©´

`Codegen` ì´ë¼ëŠ” ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ë‹¹ ì˜ì—­ì˜ 3ê°€ì§€ ì˜µì…˜ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

<img width="300" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/17b25b57-658c-4475-b879-c91108187b0c">

***

#### âœ… Category/Extension

Category/Extension ì˜µì…˜ì„ ì„ íƒí•˜ë©´ ê´€ë¦¬ ê°œì²´ í•˜ìœ„ í´ë˜ìŠ¤ ë‚´ì— ì¶”ê°€ í¸ì˜ ë©”ì„œë“œë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ë‹¹ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ í´ë˜ìŠ¤ íŒŒì¼ì„ ì™„ì „íˆ ì œì–´í•˜ëŠ” â€‹â€‹ë™ì‹œì— ì†ì„± íŒŒì¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ëª¨ë¸ í¸ì§‘ê¸°ë¥¼ í†µí•´ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

Class ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë§Œë“¤ê³  ìœ ì§€í•˜ëŠ” ê²ƒì€ ê°œë°œìì˜ ì„ íƒì…ë‹ˆë‹¤.

- íŒŒì¼ ìƒì„± ë°©ë²•
  - Model íŒŒì¼ í´ë¦­ -> Editor -> Create NSManagedObject Subclass... ìœ¼ë¡œ íŒŒì¼ì„ ìƒì„±í•´ ì¤ë‹ˆë‹¤.
  - íŒŒì¼ì„ ìƒì„±í•˜ë©´ 2ê°œì˜ íŒŒì¼ ì¶”ê°€ë˜ëŠ”ë° ê·¸ ì¤‘ `CoreDataProperties.swift` íŒŒì¼ì€ ì‚­ì œí•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤.
  - Extension ì€ Core Dataê°€ ì•Œì•„ì„œ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©´ ì¤‘ë³µë˜ì–´ ì—ëŸ¬ê°€ ë°œìƒ í•©ë‹ˆë‹¤.

**ì•„ë˜ ì´ë¯¸ì§€ ì²˜ëŸ¼ `CoreDataClass` íŒŒì¼ë§Œ ë‚¨ê²¨ë†”ì•¼ í•©ë‹ˆë‹¤!!**   

 <img width="250" height="330" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/38eab6a7-031a-4fee-baee-c04a95ecca0e">

***

#### âœ… Class Definition

Core Data ê°€ ìƒì„±í•˜ëŠ” ê´€ë¦¬ ê°œì²´ í•˜ìœ„ í´ë˜ìŠ¤ ë° ì†ì„± íŒŒì¼ì˜ ì†ì„±ì´ë‚˜ ê¸°ëŠ¥ì„ í¸ì§‘í•  í•„ìš”ê°€ ì—†ëŠ” ê²½ìš° Class Definition ì˜µì…˜ì„ ì„ íƒí•©ë‹ˆë‹¤.

ìƒì„±ëœ ì†ŒìŠ¤ ì½”ë“œëŠ” í”„ë¡œì íŠ¸ì˜ ì†ŒìŠ¤ ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 

XcodeëŠ” ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ì˜ ì¼ë¶€ë¡œ í´ë˜ìŠ¤ ë° ì†ì„± íŒŒì¼ì„ ìƒì„±í•˜ê³  ì´ë¥¼ í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë””ë ‰í„°ë¦¬ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ íŒŒì¼ì€ ë°ì´í„° ëª¨ë¸ì—ì„œ ê´€ë ¨ ì—”í„°í‹°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë‹¤ì‹œ ìƒì„±ë©ë‹ˆë‹¤.

***

#### âœ… Manual/None

ê´€ë¦¬ ê°œì²´ í•˜ìœ„ í´ë˜ìŠ¤ì˜ ì†ì„±ì„ í¸ì§‘í•˜ë ¤ë©´ Manual/None ì˜µì…˜ì„ ì„ íƒí•©ë‹ˆë‹¤.

í•´ë‹¹ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ Core Data ëŠ” ê´€ë¦¬ ê°œì²´ë¥¼ ì§€ì›í•˜ëŠ” íŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 

ì†ì„±ì„ í¬í•¨í•˜ì—¬ í´ë˜ìŠ¤ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë§Œë“¤ê³  ìœ ì§€ ê´€ë¦¬í•©ë‹ˆë‹¤. 

ê·¸ëŸ° ë‹¤ìŒ Core DataëŠ” í´ë˜ìŠ¤ ì´ë¦„ ë° ëª¨ë“ˆ í•„ë“œì— ì œê³µí•œ ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ íŒŒì¼ì„ ì°¾ìŠµë‹ˆë‹¤.

- íŒŒì¼ ìƒì„± ë°©ë²•
  - Model íŒŒì¼ í´ë¦­ -> Editor -> Create NSManagedObject Subclass... ìœ¼ë¡œ íŒŒì¼ì„ ìƒì„±í•´ ì¤ë‹ˆë‹¤.
  - XcodeëŠ” Class ì™€ Properties íŒŒì¼ì„ ëª¨ë‘ í”„ë¡œì íŠ¸ì— ë°°ì¹˜í•©ë‹ˆë‹¤.
  - ì´ì œ í”„ë¡œì íŠ¸ ì†ŒìŠ¤ ëª©ë¡ì—ì„œ í´ë˜ìŠ¤ ë° ì†ì„± íŒŒì¼ì„ ëª¨ë‘ ë³´ê³  í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 
***

### ğŸ”¥ Core Data Stack

`Core Data Stack` ì€ Core Data ì˜ í•µì‹¬ ì…ë‹ˆë‹¤.

`Core Data Stack` ì€ ì•±ì˜ ëª¨ë¸ layer ë¥¼ ê´€ë¦¬í•˜ê³  ìœ ì§€í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

<img width="600" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/b141eed7-a4d3-48d7-8fc3-dfcad31a2b1e">

Core Data Stack ì€ ì•„ë˜ì˜ ìš”ì†Œë“¤ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.

- NSManagedObjectModel
- NSManagedObjectContext
- NSPersistentStoreCoordinator
- NSPersistentContainer

***

#### âœ… NSManagedObjectModel

NSManagedObjectModel ì€ App ì˜ ì—”í„°í‹°ë¥¼ ì„¤ëª…í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤

NSManagedObjectModel ì€ Core Data ì˜ ì˜êµ¬ ì €ì¥ ë©”ì»¤ë‹ˆì¦˜ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê° ì—”í„°í‹° ê°œì²´ì™€ í•´ë‹¹ ê´€ë¦¬ ê°œì²´ í´ë˜ìŠ¤ ê°„ì˜ ë§¤í•‘ì„ ìœ ì§€í•©ë‹ˆë‹¤.

managed objects ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

***

#### âœ… NSManagedObjectContext

ê´€ë¦¬ë˜ëŠ” ê°œì²´(NSManagedObject)ì˜ ìˆ˜ëª…ì£¼ê¸°ë¥¼ ì œì–´í•˜ê³  ê°œì²´ë¥¼ ìƒì„±, ì €ì¥ ë° ê°€ì ¸ì˜¤ëŠ”(fetch) ì‘ì—…ì„ ì œê³µí•©ë‹ˆë‹¤. 

***

#### âœ… NSPersistentStoreCoordinator

NSPersistentStoreCoordinator ëŠ” persistentÂ storage(ì˜êµ¬ ì €ì¥ì†Œ)ì™€ managedÂ objectÂ model ì„ ì—°ê²°í•©ë‹ˆë‹¤.Â 

NSPersistentStoreCoordinator ëŠ” ê°ì²´ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ê°€ì ¸ì˜¬ ë•Œ NSManagedObjectContext ì— ì˜í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

<img width="600" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-15 á„‹á…©á„’á…® 8 16 32" src="https://github.com/DevWooHyeon/TIL_iOS/assets/123448121/76e24364-b550-4703-b283-081f20576925">

***

#### âœ… NSPersistentContainer

Core Data Stack ì„ ë‚˜íƒ€ë‚´ëŠ” í•„ìš”í•œ ëª¨ë“  ê°ì²´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.Â 

***

### ğŸ”¥ ì˜ˆì‹œ ì½”ë“œ

~~~ swift
import UIKit
import CoreData

final class CoreDataManager {
    static let shared = CoreDataManager()
    
    private init() {}
    
    private let context = (UIApplication.shared.delegate as! AppDelegate).persistentContainer.viewContext
    
    private func saveContextData() {
        if context.hasChanges {
            do {
                try context.save()
            } catch {
                print(error)
            }
        }
    }
   
    // MARK: - Create
    func createDiaryData(title: String? = nil, body: String? = nil) -> DiaryData {
        let entity = NSEntityDescription.entity(forEntityName: "DiaryData", in: context)
        
        if let diaryData = NSManagedObject(entity: entity, insertInto: context) as? DiaryData {
            diaryData.title = title
            diaryData.date = Date.generateTodayDate()
            diaryData.body = body
            
            saveContextData()
        }
    }
    
    // MARK: - Read
    func readDiaryData() -> [DiaryData] {
        var diaryData: [DiaryData] = []
        let request = NSFetchRequest<NSManagedObject>(entityName: "DiaryData")
        
        do {
            if let data = try context.fetch(request) as? DiaryData {
                diaryData = data
            }
        } catch {
            print(error)
        }
        
        return diaryData
    }
    
    // MARK: - Update
    func updateDiaryData(diary: DiaryData, title: String, body: String) {
        diary.title = title
        diary.body = body
        
        saveContextData()
    }
    
    // MARK: - Delete
    func deleteDiaryData(diary: DiaryData) {
        context.delete(diary)
        
        saveContextData()
    }
}
~~~

***

### âš ï¸ ì°¸ê³ ìë£Œ
- [Apple Documentation - Core Data](https://developer.apple.com/documentation/coredata/)
- [Apple Documentation - Core Data stack](https://developer.apple.com/documentation/coredata/core_data_stack)
- [Apple Documentation - Setting Up a Core Data Stack Manually](https://developer.apple.com/documentation/coredata/setting_up_a_core_data_stack/setting_up_a_core_data_stack_manually)
- [Apple Documentation - Making Apps with Core Data WWDC](https://developer.apple.com/videos/play/wwdc2019/230/)
- [Blog - Core Data (1)](https://zeddios.tistory.com/987)
- [Blog - Core Data (2)](https://zeddios.tistory.com/989)
